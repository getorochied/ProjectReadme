{% extends 'base.html.twig' %}

{% block title %}{{ user.username }} - README MiNET{% endblock %}

{% block body %}
<!-- User Details Section-->
<section class="page-section" id="user">
    <div class="container">
        <!-- User Section Heading-->
        <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">
            <i class="fas fa-user"></i> {{ user.username }}
        </h2>
        <div class="divider-custom">
            <div class="divider-custom-line"></div>
            <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
            <div class="divider-custom-line"></div>
        </div>
        
        <!-- User Info -->
        <div class="row justify-content-center mb-5">
            <div class="col-lg-8">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <table class="table table-bordered">
                            <tbody>
                                <tr>
                                    <th style="width: 30%;">ID</th>
                                    <td>{{ user.id }}</td>
                                </tr>
                                <tr>
                                    <th>Nom d'utilisateur</th>
                                    <td>{{ user.username }}</td>
                                </tr>
                                <tr>
                                    <th>Email</th>
                                    <td>{{ user.email }}</td>
                                </tr>
                                <tr>
                                    <th>Rôles</th>
                                    <td>
                                        {% for role in user.roles %}
                                            <span class="badge bg-info">{{ role }}</span>
                                        {% endfor %}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Portfolio Personnel Section -->
        {% if user.portfolio %}
            <div class="row justify-content-center mb-4">
                <div class="col-lg-8">
                    <div class="card shadow border-primary">
                        <div class="card-header bg-primary text-white">
                            <h4 class="mb-0">
                                <i class="fas fa-folder-open"></i> 
                                Portfolio Personnel
                            </h4>
                        </div>
                        <div class="card-body">
                            <p class="lead mb-3">{{ user.portfolio.description }}</p>
                            
                            {% if user.portfolio.projects|length > 0 %}
                                <p class="text-muted mb-2">
                                    <i class="fas fa-briefcase"></i> 
                                    {{ user.portfolio.projects|length }} projet(s) dans le portfolio
                                </p>
                                <a href="{{ path('app_portfolio_show', {'id': user.portfolio.id}) }}" 
                                   class="btn btn-primary">
                                    <i class="fas fa-eye"></i> Voir le portfolio complet
                                </a>
                            {% else %}
                                <p class="text-muted">
                                    <i class="fas fa-info-circle"></i> 
                                    Aucun projet dans ce portfolio pour le moment.
                                </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Showcases Section -->
        <div class="row justify-content-center mb-4">
            <div class="col-lg-8">
                <div class="card shadow border-success">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-image"></i> 
                            Showcases de {{ user.username }}
                        </h4>
                        {% if app.user %}
                            <a href="{{ path('app_user_showcase_new', {'id': user.id}) }}" 
                               class="btn btn-light btn-sm">
                                <i class="fas fa-plus"></i> Créer une showcase
                            </a>
                        {% endif %}
                    </div>
                    <div class="card-body">
                        {% set user_showcases = [] %}
                        {% for showcase in user.showcases %}
                            {% set user_showcases = user_showcases|merge([showcase]) %}
                        {% endfor %}

                        {% if user_showcases|length > 0 %}
                            <ul class="list-group">
                                {% for showcase in user_showcases %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>{{ showcase.title }}</strong>
                                            <br>
                                            <small class="text-muted">{{ showcase.description|slice(0, 80) }}...</small>
                                        </div>
                                        <div>
                                            {% if showcase.isPublic %}
                                                <span class="badge bg-success me-2">Public</span>
                                            {% else %}
                                                <span class="badge bg-warning text-dark me-2">Privé</span>
                                            {% endif %}
                                            <a href="{{ path('app_showcase_show', {'id': showcase.id}) }}" 
                                               class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye"></i> Voir
                                            </a>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-muted text-center mb-0">
                                <i class="fas fa-info-circle"></i> 
                                Aucune showcase pour le moment.
                                {% if app.user %}
                                    <a href="{{ path('app_user_showcase_new', {'id': user.id}) }}">Créez-en une !</a>
                                {% endif %}
                            </p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Projets contributés Section -->
        {% if user.projects|length > 0 %}
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card shadow">
                        <div class="card-header bg-info text-white">
                            <h4 class="mb-0">
                                <i class="fas fa-users"></i> 
                                Projets collaboratifs
                            </h4>
                        </div>
                        <div class="card-body">
                            <p class="lead">Projets auxquels {{ user.username }} contribue en tant que membre :</p>
                            <ul class="list-group">
                                {% for project in user.projects %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>{{ project.title }}</strong>
                                            <br>
                                            <small class="text-muted">{{ project.description|slice(0, 80) }}...</small>
                                        </div>
                                        <span class="badge 
                                            {% if project.status == 'completed' %}bg-success
                                            {% elseif project.status == 'in_progress' %}bg-warning text-dark
                                            {% else %}bg-secondary{% endif %}">
                                            {{ project.status }}
                                        </span>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="alert alert-warning text-center">
                        <i class="fas fa-exclamation-triangle"></i>
                        Ce membre ne contribue à aucun projet pour le moment.
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Navigation -->
        <div class="text-center mt-5">
            <a href="{{ path('app_user_index') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Retour à la liste des membres
            </a>
        </div>
    </div>
</section>
{% endblock %}